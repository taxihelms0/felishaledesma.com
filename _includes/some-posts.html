<div class="container">
  {% for post in site.posts %}
    <div class="grid-container hoverable" id="{{ post.title | slugify }}">
      <div class="grid-item post-title">{{ post.title }}</div>
      {% if post.type == 'audio' and post.mediaFile %}
      <div class="grid-item post-audio">
        <!-- old audio player code -->
        <!-- <audio controls {% if !post.downloadable %}controlsList="nodownload"{% endif %}>
          <source src="{{ post.mediaFile }}" preload="auto">
          Sorry, your browser does not support the audio player!
        </audio> -->
        <!-- new audio oplayer code -->
        <div class="audioplayer">
          <div id="{{ post.title | slugify }}" class="play">
            <i class="fa fa-play" aria-label="Play"></i>
          </div>
          <div id="timeline-{{ post.title | slugify }}" class="timeline">
            <div id="playhead-{{ post.title | slugify }}" class="playhead"></div>
          </div>
          {% if post.downloadable %}
          <div class="download-link">
            <a href="{{post.mediaFile}}" download>download</a>
          </div>
          {% endif %}
          <audio id="{{ post.title | slugify }}-player">
            <source = "{{ post.mediaFile }}" preload = "auto">
              Sorry, your browser does not support the audio player!
          </audio>
        </div>
        <!--  -->

        
      </div>
      {% else %}
      <div class="grid-item post-excerpt">{{ post.excerpt | strip_html }}</div>
      <!-- <div class="grid-item post-date">{{ post.date | date_to_string }}</div> -->
      {% endif %}
    </div>
    <div class="section collapsible collapsed" id ="{{ post.title | slugify }}-content">
      {% if post.excerpt contains "://" %}{{ post.content }}{% else %}{{ post.content | remove_first: post.excerpt }}{% endif %}
    </div>
  {% endfor %}
</div>

<script>
  const pButtons = document.querySelectorAll('.play');
  pButtons.forEach(pButton => {
    pButton.addEventListener('click', () => {
      playAudio(pButton.id); 
    });
  });

  function playAudio(e) {
    const player = document.querySelector(`#${e}-player`);
    console.log(player);
    pButtons.forEach((pButton) => {
      if(pButton.id === e) {
        if (player.paused) {
          player.play();
          pButton.className = "";
          pButton.className = "pause";
          pButton.innerHTML = '<i class="fa fa-pause" aria-label="Pause"></i>';
        } else {
          player.pause();
          pButton.className = "";
          pButton.className = "play";
          pButton.innerHTML = '<i class="fa fa-play" aria-label="Play"></i>';
        }
      }
    });
  }

  // function playAudio() {
  // if (music.paused) {
  //   music.play();
  //   pButton.className = "";
  //   pButton.className = "pause";
  // } else {
  //   music.pause();
  //   pButton.className = "";
  //   pButton.className = "play";
  // }
// }
</script>